(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{459:function(a,t,s){"use strict";s.r(t);var e=s(1),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"更换数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更换数据库"}},[a._v("#")]),a._v(" 更换数据库")]),a._v(" "),s("h2",{attrs:{id:"步骤一-判断是否需要添加数据库方言配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤一-判断是否需要添加数据库方言配置"}},[a._v("#")]),a._v(" 步骤一：判断是否需要添加数据库方言配置")]),a._v(" "),s("p",[s("strong",[a._v("Eurynome Cloud")]),a._v(' 使用数据库"方言"配置模式，以达到规范化数据库配置,减少参数修改,快速更换数据库的目的。')]),a._v(" "),s("p",[a._v("目前，"),s("strong",[a._v("Eurynome Cloud")]),a._v(" 默认提供"),s("code",[a._v("postgresql")]),a._v("和"),s("code",[a._v("mysql8")]),a._v(","),s("code",[a._v("mysql57")]),a._v("三种方言配置。在Nacos的配置中可以找到"),s("code",[a._v("eurynome-cloud-database-postgresql.yaml")]),a._v("和"),s("code",[a._v("eurynome-cloud-database-mysql8.yaml")]),a._v(","),s("code",[a._v("eurynome-cloud-database-mysql57.yaml")]),a._v("与之对应。")]),a._v(" "),s("p",[a._v("如果你所使用的数据库，"),s("code",[a._v("postgresql")]),a._v("和"),s("code",[a._v("mysql8")]),a._v(","),s("code",[a._v("mysql57")]),a._v("三种方言配置并不能满足，那么请按照下面几步操作；如果能满足请跳过。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("在Nacos中新建一个按照格式 "),s("code",[a._v("eurynome-cloud-database-<database.type>.yaml")]),a._v(" 命名的配置。")])]),a._v(" "),s("li",[s("p",[a._v("复制下面的配置内容到该配置中，注意不要改变格式以及具体配置名。")])])]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("herodotus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("database-information")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("platform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" postgresql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver-class-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" org.postgresql.Driver\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("dialect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" org.hibernate.dialect.PostgreSQL10Dialect\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("herodotus.environment.database.host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("herodotus.environment.database.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("/$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("herodotus.environment.database.name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("根据自己使用的数据库，修改配置中对应的的信息。")])]),a._v(" "),s("div",{staticClass:"custom-block info"},[s("p",{staticClass:"custom-block-title"},[a._v("说明")]),a._v(" "),s("p",[a._v("eurynome-cloud-database-<database.type>.yaml中，主要包含针对不同类型数据库，所使用的JDBC Driver等相关配置信息。")]),a._v(" "),s("ul",[s("li",[a._v("platform：指定数据库类型。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注意：platform具体值来源于枚举类"),s("code",[a._v("org.springframework.orm.jpa.vendor.Database")]),a._v("，请使用全部小写字母值进行配置。这个值不分版本，所以mysql5数据库和mysql8数据库均是使用"),s("code",[a._v("mysql")]),a._v("，目前支持的值如下：\n"),s("code",[a._v("db2")]),a._v(","),s("code",[a._v("derby")]),a._v(","),s("code",[a._v("h2")]),a._v(","),s("code",[a._v("hana")]),a._v(","),s("code",[a._v("hsql")]),a._v(","),s("code",[a._v("informix")]),a._v(","),s("code",[a._v("mysql")]),a._v(","),s("code",[a._v("oracle")]),a._v(","),s("code",[a._v("postgresql")]),a._v(","),s("code",[a._v("sql_server")]),a._v(","),s("code",[a._v("sybase")])])]),a._v(" "),s("ul",[s("li",[a._v("driver-class-name：数据库驱动类名。")]),a._v(" "),s("li",[a._v("dialect: 指定Hibernate针对不同的数据库的Dialect，org.hibernate.dialect 包下可以找到具体数据库对应的dialect。")]),a._v(" "),s("li",[a._v("url：数据库连接URL。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注意：这里的的URL是通过配置"),s("code",[a._v("eurynome-cloud-environment.yaml")]),a._v("，中的herodotus.environment.database.host,port,name等三个值组装而成。如果新增方言配置，不管具体数据库URL内容是什么，一定确保数据库地址,端口,数据库名使用"),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mrow",[s("mi",[a._v("h")]),s("mi",[a._v("e")]),s("mi",[a._v("r")]),s("mi",[a._v("o")]),s("mi",[a._v("d")]),s("mi",[a._v("o")]),s("mi",[a._v("t")]),s("mi",[a._v("u")]),s("mi",[a._v("s")]),s("mi",{attrs:{mathvariant:"normal"}},[a._v(".")]),s("mi",[a._v("e")]),s("mi",[a._v("n")]),s("mi",[a._v("v")]),s("mi",[a._v("i")]),s("mi",[a._v("r")]),s("mi",[a._v("o")]),s("mi",[a._v("n")]),s("mi",[a._v("m")]),s("mi",[a._v("e")]),s("mi",[a._v("n")]),s("mi",[a._v("t")]),s("mi",{attrs:{mathvariant:"normal"}},[a._v(".")]),s("mi",[a._v("d")]),s("mi",[a._v("a")]),s("mi",[a._v("t")]),s("mi",[a._v("a")]),s("mi",[a._v("b")]),s("mi",[a._v("a")]),s("mi",[a._v("s")]),s("mi",[a._v("e")]),s("mi",{attrs:{mathvariant:"normal"}},[a._v(".")]),s("mi",[a._v("h")]),s("mi",[a._v("o")]),s("mi",[a._v("s")]),s("mi",[a._v("t")])],1),s("mo",{attrs:{separator:"true"}},[a._v(",")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[a._v("{herodotus.environment.database.host},")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.8888799999999999em","vertical-align":"-0.19444em"}}),s("span",{staticClass:"mord"},[s("span",{staticClass:"mord mathnormal"},[a._v("h")]),s("span",{staticClass:"mord mathnormal"},[a._v("ero")]),s("span",{staticClass:"mord mathnormal"},[a._v("d")]),s("span",{staticClass:"mord mathnormal"},[a._v("o")]),s("span",{staticClass:"mord mathnormal"},[a._v("t")]),s("span",{staticClass:"mord mathnormal"},[a._v("u")]),s("span",{staticClass:"mord mathnormal"},[a._v("s")]),s("span",{staticClass:"mord"},[a._v(".")]),s("span",{staticClass:"mord mathnormal"},[a._v("e")]),s("span",{staticClass:"mord mathnormal"},[a._v("n")]),s("span",{staticClass:"mord mathnormal",staticStyle:{"margin-right":"0.03588em"}},[a._v("v")]),s("span",{staticClass:"mord mathnormal"},[a._v("i")]),s("span",{staticClass:"mord mathnormal"},[a._v("ro")]),s("span",{staticClass:"mord mathnormal"},[a._v("nm")]),s("span",{staticClass:"mord mathnormal"},[a._v("e")]),s("span",{staticClass:"mord mathnormal"},[a._v("n")]),s("span",{staticClass:"mord mathnormal"},[a._v("t")]),s("span",{staticClass:"mord"},[a._v(".")]),s("span",{staticClass:"mord mathnormal"},[a._v("d")]),s("span",{staticClass:"mord mathnormal"},[a._v("a")]),s("span",{staticClass:"mord mathnormal"},[a._v("t")]),s("span",{staticClass:"mord mathnormal"},[a._v("aba")]),s("span",{staticClass:"mord mathnormal"},[a._v("se")]),s("span",{staticClass:"mord"},[a._v(".")]),s("span",{staticClass:"mord mathnormal"},[a._v("h")]),s("span",{staticClass:"mord mathnormal"},[a._v("os")]),s("span",{staticClass:"mord mathnormal"},[a._v("t")])]),s("span",{staticClass:"mpunct"},[a._v(",")])])])]),a._v("{herodotus.environment.database.port},${herodotus.environment.database.name}三个站位符替换，否则*-environment.yaml中配置的值将不再生效。")])])]),a._v(" "),s("h2",{attrs:{id:"步骤二-修改环境参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤二-修改环境参数"}},[a._v("#")]),a._v(" 步骤二：修改环境参数")]),a._v(" "),s("p",[a._v("在根据你所使用的 "),s("RouterLink",{attrs:{to:"/guide/profile-design.html"}},[a._v("Maven多环境")]),a._v("，找到 "),s("code",[a._v("Nacos")]),a._v(" 对应 "),s("code",[a._v("Group")]),a._v(" 下的"),s("code",[a._v("eurynome-cloud-environment.yaml")]),a._v("配置，修改数据库相关的"),s("code",[a._v("host")]),a._v(","),s("code",[a._v("port")]),a._v(","),s("code",[a._v("name")]),a._v(","),s("code",[a._v("username")]),a._v(","),s("code",[a._v("password")]),a._v("等几个参数的值。")],1),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("herodotus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("logstash-server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5044")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("gateway-server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8847")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("database")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 127.0.0.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5432")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" herodotus\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" XXXXX\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" XXXXX\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h2",{attrs:{id:"步骤三-修改pom-xml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤三-修改pom-xml"}},[a._v("#")]),a._v(" 步骤三：修改pom.xml")]),a._v(" "),s("p",[a._v("找到工程根目录下的"),s("code",[a._v("pom.xml")]),a._v(", 根据你所使用的 "),s("RouterLink",{attrs:{to:"/guide/profile-design.html"}},[a._v("Maven多环境")]),a._v("找到对应的"),s("code",[a._v("<profiles>")]),a._v(", 修改"),s("code",[a._v("<database.type>")]),a._v("属性值。")],1),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("database.type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("postgresql"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("database.type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("p",[a._v("该值与步骤一中，"),s("code",[a._v("eurynome-cloud-database-<database.type>.yaml")]),a._v("的值对应。")]),a._v(" "),s("p",[a._v("在Maven编译的过程中，"),s("code",[a._v("<database.type>")]),a._v("的值会作为参数传递到各个服务的"),s("code",[a._v("boostrap.yml")]),a._v("配置中，与"),s("code",[a._v("boostrap.yml")]),a._v("中已有的信息拼装成Nacos中对应的配置名。通过这种方式实现Maven多环境,Nacos配置,不同数据库配置的联动")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" eurynome"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("@database.type@.yaml\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" common\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("h2",{attrs:{id:"步骤四-添加数据库jdbc-driver"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤四-添加数据库jdbc-driver"}},[a._v("#")]),a._v(" 步骤四：添加数据库JDBC Driver")]),a._v(" "),s("p",[a._v("目前，系统代码已经包含 "),s("code",[a._v("PostgreSQL")]),a._v(" , "),s("code",[a._v("MySQL")]),a._v(" (支持 "),s("code",[a._v("MySQL5")]),a._v(" 和 "),s("code",[a._v("MySQL8")]),a._v(" )和 "),s("code",[a._v("H2")]),a._v(" 三种数据库的"),s("code",[a._v("JDBC Driver")]),a._v(", 如果你使用数据库不在此范围内，那么就需要在代码包"),s("code",[a._v("eurynome-cloud-data")]),a._v("的"),s("code",[a._v("pom.xml")]),a._v("中添加对应数据库的"),s("code",[a._v("JDBC Driver")]),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"步骤五-编译工程代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤五-编译工程代码"}},[a._v("#")]),a._v(" 步骤五：编译工程代码")]),a._v(" "),s("p",[a._v("以上步骤完成之后，使用"),s("code",[a._v("mvn package")]),a._v("或"),s("code",[a._v("mvn install")]),a._v("命令，重新编译工程。")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("警告")]),a._v(" "),s("p",[a._v("这一步非常重要，因为"),s("code",[a._v("Maven")]),a._v("无法真正做到与"),s("code",[a._v("yml")]),a._v("配置文件的传参，只有通过编译，在编译过程中用"),s("code",[a._v("pom.xml")]),a._v("中"),s("code",[a._v("<database.type>")]),a._v("的值，替换yml配置文件中的"),s("code",[a._v("@database.type@")]),a._v("模拟一种参数传递。")])]),a._v(" "),s("p",[a._v("修改配置之后，参考"),s("RouterLink",{attrs:{to:"/guide/data-initialization.html"}},[a._v("数据初始化")]),a._v("章节进行数据库初始化工作。")],1),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),s("p",[a._v("目前仅提供 "),s("code",[a._v("PostgreSQL")]),a._v(" 和 "),s("code",[a._v("MySQL")]),a._v(" 两种数据库对应的数据初始化脚本，其它数据库需要自己额外处理。如需要使用"),s("code",[a._v("Spring Data JPA")]),a._v("初始化机制，需要手动修改"),s("code",[a._v("spring.sql.init.*")]),a._v("相关参数。")])]),a._v(" "),s("h2",{attrs:{id:"步骤六-修改工作流服务数据库类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#步骤六-修改工作流服务数据库类型"}},[a._v("#")]),a._v(" 步骤六：修改工作流服务数据库类型")]),a._v(" "),s("p",[a._v("在 "),s("code",[a._v("eurynome-cloud-bpmn-ability")]),a._v(" 模块中，找到"),s("code",[a._v("bootstrap.yml")]),a._v("。根据你所使用的数据库，修改配置"),s("code",[a._v("camunda.bpm.database.type")]),a._v("的值。")]),a._v(" "),s("div",{staticClass:"custom-block info"},[s("p",{staticClass:"custom-block-title"},[a._v("说明")]),a._v(" "),s("p",[s("code",[a._v("camunda.bpm.database.type")]),a._v("支持的值有: "),s("code",[a._v("h2")]),a._v(", "),s("code",[a._v("mysql")]),a._v(", "),s("code",[a._v("mariadb")]),a._v(", "),s("code",[a._v("oracle")]),a._v(", "),s("code",[a._v("postgres")]),a._v(", "),s("code",[a._v("mssql")]),a._v(", "),s("code",[a._v("db2")]),a._v(".")])])])}),[],!1,null,null,null);t.default=n.exports}}]);